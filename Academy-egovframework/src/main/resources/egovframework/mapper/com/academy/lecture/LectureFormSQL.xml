<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="lectureForm">

	<select id="selectFormList" parameterType="hashMap" resultType="hashMap">
					SELECT
						LEC_DIV, (SELECT CODE_NM FROM BA_CONFIG_CD WHERE SYS_CD = 'LEC_FORM' AND CODE_VAL = AA.LEC_DIV) AS LEC_DIVNM
						, FORM_CODE, FORM_NAME, IS_USE
						, CASE IS_USE WHEN 'Y' THEN '활성' WHEN 'N' THEN '비활성' END ISUSENM
						, REG_DT, REG_ID, UPD_DT, UPD_ID
					FROM ACM_LEARNING_FORM_INFO AA
					WHERE 1 = 1
				 	<if test="SEARCHTEXT != null and SEARCHTEXT != ''">
						<if test="SEARCHTYPE != null and SEARCHTYPE != ''">
							<if test="SEARCHTYPE == 1">
								AND CODE LIKE CONCAT ('%', #{SEARCHTEXT},'%')
							</if>
							<if test="SEARCHTYPE == 2">
								AND NAME LIKE CONCAT ('%', #{SEARCHTEXT},'%')
							</if>
						</if>
						<if test="SEARCHTYPE == null or SEARCHTYPE == ''">
							AND (
								CODE LIKE CONCAT ('%', #{SEARCHTEXT},'%')
								OR NAME LIKE CONCAT ('%', #{SEARCHTEXT},'%')
							)
						</if>
					</if>
				 	ORDER BY UPD_DT DESC
        LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>

	<select id="selectFormListCount" parameterType="hashMap" resultType="int">
		SELECT
			COUNT(CODE)
		FROM ACM_LEARNING_FORM_INFO
		WHERE 1 = 1
	 	<if test="SEARCHTEXT != null and SEARCHTEXT != ''">
			<if test="SEARCHTYPE != null and SEARCHTYPE != ''">
				<if test="SEARCHTYPE == 1">
					AND CODE LIKE CONCAT ('%', #{SEARCHTEXT},'%')
				</if>
				<if test="SEARCHTYPE == 2">
					AND NAME LIKE CONCAT ('%', #{SEARCHTEXT},'%')
				</if>
			</if>
			<if test="SEARCHTYPE == null or SEARCHTYPE == ''">
				AND (
					CODE LIKE CONCAT ('%', #{SEARCHTEXT},'%')
					OR NAME LIKE CONCAT ('%', #{SEARCHTEXT},'%')
				)
			</if>
		</if>
	</select>

	<select id="selectFormDetail" parameterType="hashMap" resultType="hashMap">
		SELECT
			LEC_DIV, (SELECT CODE_NM FROM TB_BA_CONFIG_CD WHERE SYS_CD = 'LEC_FORM' AND CODE_CD = AA.LEC_DIV) AS LEC_DIVNM
			, CODE, NAME, ISUSE
			, DECODE(ISUSE, 'Y', '활성', 'N', '비활성') ISUSENM
			, REG_DT, REG_ID, UPD_DT, UPD_ID
		FROM ACM_LEARNING_FORM_INFO AA
		WHERE CODE = #{CODE}
	</select>

	<select id="selectFormGetCode" resultType="String">
		SELECT
			REPLACE('M'||TO_CHAR(NVL(substr(MAX(CODE), 2, 5),100)+1 ,'0000'),' ','') CODE
		FROM ACM_LEARNING_FORM_INFO
	</select>

	<select id="selectCodeList" parameterType="hashMap" resultType="hashMap">
		SELECT
			LEC_DIV, CODE_NM, FORM_CODE, FORM_NAME, IS_USE, REG_DT, REG_ID, UPD_DT, UPD_ID
		FROM ACM_LEARNING_FORM_INFO
		WHERE 1 = 1
		<if test="SEARCHPCODE != null and SEARCHPCODE != ''">
			AND SYS_CD = #{SEARCHPCODE}
		</if>
		<if test="SEARCHCCODE != null and SEARCHCCODE != ''">
			AND SYS_CD = #{SEARCHCCODE}
		</if>
		<if test="SEARCHCODEISUSE != null and SEARCHCODEISUSE != ''">
			AND IS_USE = #{SEARCHCODEISUSE}
		</if>
	</select>

	<insert id="insertForm" parameterType="hashMap" flushCache="true">
		INSERT INTO ACM_LEARNING_FORM_INFO (LEC_DIV, CODE, NAME, ISUSE, REG_DT, REG_ID, UPD_DT, UPD_ID)
		VALUES (#{LEC_DIV}, #{CODE}, #{NAME}, #{ISUSE}, SYSDATE, #{REG_ID}, SYSDATE, #{UPD_ID})
	</insert>

	<update id="updateForm" parameterType="hashMap">
		UPDATE ACM_LEARNING_FORM_INFO
		SET
			LEC_DIV = #{LEC_DIV}
			, NAME = #{NAME}
			, ISUSE = #{ISUSE}
			, UPD_DT = SYSDATE
			, UPD_ID = #{UPD_ID}
		WHERE CODE = #{CODE}
	</update>

	<delete id="deleteForm" parameterType="hashMap">
		UPDATE ACM_LEARNING_FORM_INFO
		SET ISUSE = 'N'
		WHERE CODE = #{CODE}
	</delete>

	<select id="selectFormCheck" parameterType="hashMap" resultType="int">
		SELECT
			COUNT(CODE)
		FROM ACM_LEARNING_FORM_INFO
		WHERE 1 = 1
		<if test="CODE != null and CODE != ''">
			AND CODE = #{CODE}
		</if>
	</select>

</mapper>